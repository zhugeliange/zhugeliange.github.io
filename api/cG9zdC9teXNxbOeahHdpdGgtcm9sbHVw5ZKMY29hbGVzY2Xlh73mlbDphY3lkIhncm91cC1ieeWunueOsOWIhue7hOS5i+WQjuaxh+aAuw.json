{"title":"mysql的with-rollup和coalesce函数配合group-by实现分组之后汇总","date":"2017-08-07T09:49:44.000Z","slug":"mysql的with-rollup和coalesce函数配合group-by实现分组之后汇总","comments":true,"tags":["coalesce","group by","mysql","with rollup","函数","分组","汇总"],"categories":["mysql"],"updated":"2019-04-02T09:49:44.000Z","content":"<html><head></head><body><ul><li><strong>WITH ROLLUP</strong> 可以实现在分组统计数据基础上再进行相同的统计（<strong>SUM</strong>，<strong>AVG</strong>，<strong>COUNT</strong> 等）。</li></ul><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">name</span>, <span class=\"keyword\">SUM</span>(singin) <span class=\"keyword\">as</span> singin_count <span class=\"keyword\">FROM</span>  employee_tbl <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> <span class=\"keyword\">name</span> <span class=\"keyword\">WITH</span> <span class=\"keyword\">ROLLUP</span>;</span><br></pre></td></tr></tbody></table></figure><p><img src=\"http://picture.oononn.com/hexo/with-rollup.png?m=webp&q=80\" alt=\"with-rollup\"></p><ul><li>其中记录 <strong>NULL</strong> 表示所有人的登录次数。可以使用 <strong>COALESCE</strong> 来设置一个可以取代 <strong>NULL</strong> 的名称，语法如下：</li></ul><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">COALESCE</span>(a,b,c);</span><br></pre></td></tr></tbody></table></figure><ul><li><p>如果 <strong>a==NULL</strong>，则选择 <strong>b</strong>。如果 <strong>b==NULL</strong>，则选择 <strong>c</strong>。如果 <strong>a!=NULL</strong>，则选择 <strong>a</strong>。如果 <strong>a</strong>，<strong>b</strong>，<strong>c</strong> 都为 <strong>NULL</strong> ，则返回为 <strong>NULL</strong>（没意义）。</p></li><li><p>所以可以结合起来改造上面语句，用 <strong>“总数”</strong> 来替换 <strong>NULL</strong>：</p></li></ul><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">COALESCE</span>(<span class=\"keyword\">name</span>, <span class=\"string\">'总数'</span>), <span class=\"keyword\">SUM</span>(singin) <span class=\"keyword\">as</span> singin_count <span class=\"keyword\">FROM</span>  employee_tbl <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> <span class=\"keyword\">name</span> <span class=\"keyword\">WITH</span> <span class=\"keyword\">ROLLUP</span>;</span><br></pre></td></tr></tbody></table></figure><p><img src=\"http://picture.oononn.com/hexo/coalesce.png?m=webp&q=80\" alt=\"coalesce\"></p></body></html>","prev":{"title":"mysql的in和exists","slug":"mysql的in和exists"},"next":{"title":"mysql的用户设置","slug":"mysql的用户设置"},"link":"/post/mysql的with-rollup和coalesce函数配合group-by实现分组之后汇总/","reward":true,"copyright":{"license":"原创版权，转载请注明来源 (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow noopener\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","author":"沈捷译","link":"<a href=\"/post/mysql的with-rollup和coalesce函数配合group-by实现分组之后汇总/\" title=\"mysql的with-rollup和coalesce函数配合group-by实现分组之后汇总\">/post/mysql的with-rollup和coalesce函数配合group-by实现分组之后汇总/</a>"}}