{"title":"mysql的外键","date":"2017-07-02T07:30:17.000Z","slug":"mysql的外键","comments":true,"tags":["mysql","外键"],"categories":["mysql"],"updated":"2019-04-02T07:30:17.000Z","content":"<html><head></head><body><h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><ul><li><p><strong>MySQL</strong> 通过外键约束来保证表与表之间的数据的完整性和准确性。</p></li><li><p>一个表中的 <strong>FOREIGN KEY</strong> 指向另一个表中的 <strong>UNIQUE KEY</strong>(唯一约束的键，不一定是 <strong>PRIMARY KEY</strong>)。</p></li><li><p><strong>FOREIGN KEY</strong> 约束用于预防破坏表之间连接的行为。</p></li><li><p><strong>FOREIGN KEY</strong> 约束也能防止非法数据插入外键列，因为它必须是它指向的那个表中的值之一。</p></li></ul><h2 id=\"使用条件\"><a href=\"#使用条件\" class=\"headerlink\" title=\"使用条件\"></a>使用条件</h2><ul><li><p>两个表必须是 <strong>InnoDB</strong> 表，<strong>MyISAM</strong> 表暂时不支持外键。</p></li><li><p>主表的字段必须是唯一键，不一定要是主键，只要具有唯一性约束就行了。</p></li><li><p>关联的两个字段必须是 <strong>InnoDB</strong> 下的相似类型，即 <strong>INT</strong> 和 <strong>TINYINT</strong> 可以，<strong>INT</strong> 和 <strong>CHAR</strong> 就不行。</p></li><li><p>外键的字段必须建立索引，新版本已经可以自动创建索引了，不用手动创建了。</p></li><li><p>避免使用复合键，也就是说从表能够同一时候引用多个主表的字段作为一个外键，但是一般不推荐这样的做法。</p></li></ul><h2 id=\"创建\"><a href=\"#创建\" class=\"headerlink\" title=\"创建\"></a>创建</h2><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> 表<span class=\"number\">1</span></span><br><span class=\"line\">(</span><br><span class=\"line\">\t字段<span class=\"number\">1</span> <span class=\"built_in\">int</span> <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</span><br><span class=\"line\">\t字段<span class=\"number\">2</span> <span class=\"built_in\">int</span>,</span><br><span class=\"line\">\t<span class=\"keyword\">CONSTRAINT</span> symbol PRIMARY <span class=\"keyword\">KEY</span> (字段<span class=\"number\">1</span>),</span><br><span class=\"line\">\t<span class=\"keyword\">FOREIGN</span> <span class=\"keyword\">KEY</span> (字段<span class=\"number\">2</span>) <span class=\"keyword\">REFERENCES</span> 表<span class=\"number\">2</span>(字段<span class=\"number\">1</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">ON</span> 触发事件<span class=\"number\">1</span> 具体操作<span class=\"number\">1</span></span><br><span class=\"line\">\t<span class=\"keyword\">ON</span> 触发事件<span class=\"number\">2</span> 具体操作<span class=\"number\">2</span></span><br><span class=\"line\">)</span><br></pre></td></tr></tbody></table></figure><ul><li><p>表1的字段2是外键，与表2的字段1（唯一键，一般是主键）相关联。</p></li><li><p><strong>symbol</strong> 可以为选填，手动指定的话必须保证唯一性，不写就由 <strong>MySQL</strong> 自动生成，建议自动生成</p></li><li><p>触发事件有如下值：</p><ul><li><p>DELETE 删除时</p></li><li><p>UPDATE 更新时</p></li></ul></li><li><p>具体操作有如下值：</p><ul><li><p>RESTRICT 限制外表中的外键改动</p></li><li><p>CASCADE 跟随外键改动</p></li><li><p>SET NULL 设空值</p></li><li><p>SET DEFAULT 设默认值</p></li><li><p>NO ACTION 无动作，默认</p></li></ul></li><li><p>触发事件和具体操作为可选项，但必须成对出现，且可有多个。</p></li></ul><h2 id=\"修改\"><a href=\"#修改\" class=\"headerlink\" title=\"修改\"></a>修改</h2><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> 表<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span> <span class=\"keyword\">CONSTRAINT</span> symbol <span class=\"keyword\">FOREIGN</span> <span class=\"keyword\">KEY</span> (字段<span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"keyword\">REFERENCES</span> 表<span class=\"number\">2</span>(字段<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"keyword\">ON</span> 触发事件<span class=\"number\">1</span> 具体操作<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">ON</span> 触发事件<span class=\"number\">2</span> 具体操作<span class=\"number\">2</span></span><br></pre></td></tr></tbody></table></figure><h2 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h2><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> 表<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">FOREIGN</span> <span class=\"keyword\">KEY</span> 字段<span class=\"number\">2</span></span><br></pre></td></tr></tbody></table></figure></body></html>","prev":{"title":"mysql运算符","slug":"mysql运算符"},"next":{"title":"mysql的三范式","slug":"mysql的三范式"},"link":"/post/mysql的外键/","toc":[{"title":"","id":"删除","index":"1"}],"reward":true,"copyright":{"license":"原创版权，转载请注明来源 (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow noopener\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","author":"沈捷译","link":"<a href=\"/post/mysql的外键/\" title=\"mysql的外键\">/post/mysql的外键/</a>"}}